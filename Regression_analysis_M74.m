%% SOLVE FOR MOF74 PL? then using PL,PH,yAfeed, Tfeed to calculate other paramters.

clc;
%%%% Case studies for constant recovery %%%%
coeff_matrix_M74=[3.8112e-06	-0.074297	0.0014796	0.020711	-0.0010261	78.2122	0.43967	-14.7187	12.9226	-0.034474	0.32598	 -0.35282	-7.4672	-2.2578	 0.0030597
    0.00010705	0.017022	-0.00476	0.010709	-0.077622	-3.1205	-0.11986	1.371	-5.8188	-0.008707	-0.40091	2.1103	-0.1879	-3.7399	14.0105
    -9.203e-05	-0.34458	0.0078356	-0.042115	0.089127	316.4195	2.3733	67.3473	48.3633	-0.19174	-0.86165	-1.3641	84.0442	-30.918	-10.2284
    8.3453e-05	0.00032778	-0.0034174	0.0087402	-0.063389	58.1221	-0.73054	-13.9895	-7.0679	-0.039928	0.32565	1.8354	-4.2813	-0.55182	11.8597
    0.47487	-1261.9654	3.651	368.0222	-286.9899	2026972.6249	11693.8132	-294524.7966	117691.6056	-226.8863	-1808.0326	-595.261	-142026.6547	-48442.6452	51064.7072];

%[T_f^2	T_f*p_L	T_f*p_H	T_f*y_CO2	T_f	p_L^2	p_L*p_H	p_L*y_CO2	p_L
%p_H^2	p_H*y_CO2	p_H	y_CO2^2	y_CO2	constant]

%[M_CO2_prod_MOF; M_N2_prod_MOF; M_feed_MOF; M_RP_MOF; W_vacuum]
M_CO2_prod_M74_coeff=coeff_matrix_M74(1,:);
M_N2_prod_M74_coeff=coeff_matrix_M74(2,:);
M_feed_M74_coeff=coeff_matrix_M74(3,:);
M_RP_M74_coeff=coeff_matrix_M74(4,:);
W_vacuum_M74_coeff=coeff_matrix_M74(5,:);
R = 8.314; % J/kg/mol

% from the paper, p_feed is 1 bar, not 1.2 bar.
p_feed = 1; % bar

l=1;
for y_CO2_feed=0.1:0.02:0.16
    for eff_CO2=[0.5 0.75 0.9]
        for T_feed=[25 50 75]
            for p_H=[1.2 1.5:0.5:4]
                % Recovery*y_CO2*(M_RP+M_feed)=M_CO2_prod
                % Getting a quadratic equation in terms of pL ->
                % A*pL^2+B*pL+C
                A_pL=eff_CO2*y_CO2_feed*(M_RP_M74_coeff(6)+M_feed_M74_coeff(6))-...
                    M_CO2_prod_M74_coeff(6);
                B_pL=(eff_CO2*y_CO2_feed*(M_RP_M74_coeff(2)+M_feed_M74_coeff(2))-...
                    M_CO2_prod_M74_coeff(2))*(T_feed+273.15)+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(7)+M_feed_M74_coeff(7))-...
                    M_CO2_prod_M74_coeff(7))*p_H+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(8)+M_feed_M74_coeff(8))-...
                    M_CO2_prod_M74_coeff(8))*y_CO2_feed+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(9)+M_feed_M74_coeff(9))-...
                    M_CO2_prod_M74_coeff(9));
                C_pL=(eff_CO2*y_CO2_feed*(M_RP_M74_coeff(1)+M_feed_M74_coeff(1))-...
                    M_CO2_prod_M74_coeff(1))*(T_feed+273.15)^2+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(3)+M_feed_M74_coeff(3))-...
                    M_CO2_prod_M74_coeff(3))*(T_feed+273.15)*p_H+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(4)+M_feed_M74_coeff(4))-...
                    M_CO2_prod_M74_coeff(4))*(T_feed+273.15)*y_CO2_feed+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(5)+M_feed_M74_coeff(5))-...
                    M_CO2_prod_M74_coeff(5))*(T_feed+273.15)+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(10)+M_feed_M74_coeff(10))-...
                    M_CO2_prod_M74_coeff(10))*p_H^2+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(11)+M_feed_M74_coeff(11))-...
                    M_CO2_prod_M74_coeff(11))*p_H*y_CO2_feed+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(12)+M_feed_M74_coeff(12))-...
                    M_CO2_prod_M74_coeff(12))*p_H+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(13)+M_feed_M74_coeff(13))-...
                    M_CO2_prod_M74_coeff(13))*y_CO2_feed^2+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(14)+M_feed_M74_coeff(14))-...
                    M_CO2_prod_M74_coeff(14))*y_CO2_feed+...
                    (eff_CO2*y_CO2_feed*(M_RP_M74_coeff(15)+M_feed_M74_coeff(15))-...
                    M_CO2_prod_M74_coeff(15));
                
                % Solution for quadratic equation (-B+sqrt(B^2-4AC))/2A.
                % Considering only the smaller solution here.
                
                %p_L=(-B_pL+sqrt(B_pL^2-4*A_pL*C_pL))/2/A_pL
                
                % find two roots by using roots()
                % choose the minimal one of the two roots
                % keep only the real part
                r = roots([A_pL, B_pL, C_pL]);
                p_L = real(min(r));
                
                %CO2 product flow rate for Mg-MOF-74, R^2=0.9383
                M_CO2_prod_M74=3.8112e-06*(T_feed+273.15)^2-...
                    0.074297*(T_feed+273.15)*p_L+...
                    0.0014796*(T_feed+273.15)*p_H+...
                    0.020711*(T_feed+273.15)*y_CO2_feed-...
                    0.0010261*(T_feed+273.15)+...
                    78.2122*p_L^2+0.43967*p_L*p_H-14.7187*p_L*y_CO2_feed+...
                    12.9226*p_L-0.034474*p_H^2+0.32598*p_H*y_CO2_feed-...
                    0.35282*p_H-7.4672*y_CO2_feed^2-2.2578*y_CO2_feed+0.0030597;
                
                
                % N2 product flow rate for Mg-MOF-74, R^2=0.9990
                M_N2_prod_M74=0.00010705*(T_feed+273.15)^2+...
                    0.017022*(T_feed+273.15)*p_L-...
                    0.00476*(T_feed+273.15)*p_H+...
                    0.010709*(T_feed+273.15)*y_CO2_feed-...
                    0.077622*(T_feed+273.15)-3.1205*p_L^2-0.11986*p_L*p_H+...
                    1.371*p_L*y_CO2_feed-5.8188*p_L-0.008707*p_H^2-...
                    0.40091*p_H*y_CO2_feed+2.1103*p_H-0.1879*y_CO2_feed^2-...
                    3.7399*y_CO2_feed+14.0105;
                
                % Feed flow rate for Mg-MOF-74, R^2=0.9117
                M_feed_M74=-9.203e-05*(T_feed+273.15)^2-...
                    0.34458*(T_feed+273.15)*p_L+...
                    0.0078356*(T_feed+273.15)*p_H-...
                    0.042115*(T_feed+273.15)*y_CO2_feed+...
                    0.089127*(T_feed+273.15)+316.4195*p_L^2+...
                    2.3733*p_L*p_H+67.3473*p_L*y_CO2_feed+48.3633*p_L-...
                    0.19174*p_H^2-0.86165*p_H*y_CO2_feed-1.3641*p_H+...
                    84.0442*y_CO2_feed^2-30.918*y_CO2_feed-10.2284;
                
                % Repressurization flow rate for Mg-MOF-74, R^2=0.9887
                M_RP_M74=8.3453e-05*(T_feed+273.15)^2+...
                    0.00032778*(T_feed+273.15)*p_L-...
                    0.0034174*(T_feed+273.15)*p_H+...
                    0.0087402*(T_feed+273.15)*y_CO2_feed-...
                    0.063389*(T_feed+273.15)+58.1221*p_L^2-0.73054*p_L*p_H-...
                    13.9895*p_L*y_CO2_feed-7.0679*p_L-0.039928*p_H^2+...
                    0.32565*p_H*y_CO2_feed+1.8354*p_H-4.2813*y_CO2_feed^2-...
                    0.55182*y_CO2_feed+11.8597;
                
                % Work required for vacuum pump for Mg-MOF-74, R^2=0.8858
                W_vacuum_M74=0.47487*(T_feed+273.15)^2-...
                    1261.9654*(T_feed+273.15)*p_L+...
                    3.651*(T_feed+273.15)*p_H+...
                    368.0222*(T_feed+273.15)*y_CO2_feed-...
                    286.9899*(T_feed+273.15)+2026972.6249*p_L^2+...
                    11693.8132*p_L*p_H-294524.7966*p_L*y_CO2_feed+...
                    117691.6056*p_L-226.8863*p_H^2-1808.0326*p_H*y_CO2_feed-...
                    595.261*p_H-142026.6547*y_CO2_feed^2-48442.6452*y_CO2_feed+...
                    51064.7072;
                
                % Work required for blower for Mg-MOF-74
                W_blower_M74=(M_feed_M74+M_RP_M74)*(R/eff_blower)*...
                    k/(k-1)*(T_feed+273.15)*((p_H/p_feed)^((k-1)/k)-1);
                
                purity_M74=M_CO2_prod_M74/(M_CO2_prod_M74+M_N2_prod_M74);
                recovery_M74=M_CO2_prod_M74/y_CO2_feed/(M_feed_M74+M_RP_M74);
                test=eff_CO2-recovery_M74;
                specific_work_M74=(W_vacuum_M74+W_blower_M74)/M_CO2_prod_M74/44/24/3.6;
                
                M74_perf_const_recovery(l,:)=[y_CO2_feed eff_CO2 test T_feed p_H p_L ...
                    M_CO2_prod_M74 M_N2_prod_M74 M_feed_M74 M_RP_M74 ...
                    purity_M74 W_vacuum_M74 W_blower_M74 ...
                    specific_work_M74 M_RP_M74/M_feed_M74]
                
                
                l=l+1;
                
            end
        end
    end
end


